# HashTable
> Our mission is to achieve best performance with the smalles change of code.

### Hardcoding and assembling
By analizing the output of perf, I realized the the significant amount of cpu time is spent on hash function. So, I decided to take it out of template parameter and hardcode in table with inline assembly. To make it work even better, I used the version generated by g++ with -O3 flag.
```C++
unsigned long hash(const char* key){
        unsigned long d = 0;

        asm volatile(R"(
            .intel_syntax noprefix
    
            movsx   rax, BYTE PTR [rdi]
            test    al, al
            je      .L4
            xor     edx, edx
    .L3:
            add     rax, rdx
            add     rdi, 1
            mov     rdx, rax
            sal     rdx, 10
            add     rax, rdx
            mov     rdx, rax
            shr     rdx, 6
            xor     rdx, rax
            movsx   rax, BYTE PTR [rdi]
            test    al, al
            jne     .L3
            lea     rdx, [rdx+rdx*8]
            mov     rax, rdx
            shr     rax, 11
            xor     rax, rdx
            mov     rdx, rax
            sal     rdx, 15
            add     rax, rdx
            jmp .Exit
    
    .L4:
            xor     eax, eax
    .Exit:
            .att_syntax
    )"
        :"=r"(h)
		:"D"(key)
		);

		return h;

}
```
